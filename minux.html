<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>ImageTube</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
    margin: 0;
    background: #0f0f0f;
    color: white;
    font-family: Arial, sans-serif;
}

header {
    background: #202020;
    padding: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
}

header h1 {
    font-size: 18px;
    margin: 0;
}

.search { flex: 1; }

.search input {
    width: 100%;
    padding: 8px;
    border-radius: 5px;
    border: none;
    background: #303030;
    color: white;
}

.create-link {
    background: #444;
    padding: 8px 10px;
    border-radius: 5px;
    font-size: 13px;
    cursor: pointer;
}

.plus {
    font-size: 26px;
    cursor: pointer;
}

.grid {
    padding: 15px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 15px;
}

.card {
    background: #181818;
    border-radius: 8px;
    overflow: hidden;
}

.thumb {
    cursor: pointer;
}

.ratio-1x1 { aspect-ratio: 1/1; }
.ratio-16x9 { aspect-ratio: 16/9; }
.ratio-9x16 { aspect-ratio: 9/16; }

.thumb img,
.thumb video {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.card h3 {
    font-size: 14px;
    padding: 8px;
    margin: 0;
}

.delete {
    background: #ff4444;
    border: none;
    width: 100%;
    color: white;
    padding: 6px;
    cursor: pointer;
}

/* POPUP */
.popup {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    justify-content: center;
    align-items: center;
}

.popup-content {
    background: #181818;
    padding: 15px;
    width: 90%;
    max-width: 320px;
    border-radius: 8px;
}

.popup input, .popup select, .popup button {
    width: 100%;
    margin-top: 10px;
    padding: 10px;
    border-radius: 5px;
    border: none;
}

.popup input, .popup select {
    background: #303030;
    color: white;
}

.popup button {
    background: red;
    color: white;
    font-weight: bold;
}

/* FULLSCREEN */
.viewer {
    position: fixed;
    inset: 0;
    background: black;
    display: none;
    justify-content: center;
    align-items: center;
}

.viewer img,
.viewer video {
    max-width: 100%;
    max-height: 100%;
}
</style>
</head>

<body>

<header>
    <h1>IMGtube</h1>

    <div class="search">
        <input id="search" placeholder="Cari judul..." oninput="render()">
    </div>

    <div class="create-link" onclick="goCreateLink()">Create Link</div>
    <div class="plus" onclick="openPopup()">➕</div>
</header>

<div class="grid" id="gallery"></div>

<!-- POPUP UPLOAD -->
<div class="popup" id="popup">
    <div class="popup-content">
        <input id="title" placeholder="Judul">
        <input id="url" placeholder="Link gambar / video">

        <select id="type">
            <option value="image">Gambar</option>
            <option value="video">Video</option>
        </select>

        <select id="ratio">
            <option value="1x1">1 : 1</option>
            <option value="16x9">16 : 9</option>
            <option value="9x16">9 : 16</option>
        </select>

        <button onclick="upload()">Upload</button>
        <button onclick="closePopup()">Batal</button>
    </div>
</div>

<!-- FULLSCREEN -->
<div class="viewer" id="viewer" onclick="closeViewer()"></div>

<script>
function goCreateLink() {
    window.location.href = "https://rifdevlop-www.github.io/Cvv/gok.html";
}

// FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyBBT-3vGZYlb2A8_F93XsFHX54F-HuJyAU",
  authDomain: "ptube-6bd97.firebaseapp.com",
  databaseURL: "https://ptube-6bd97-default-rtdb.firebaseio.com",
  projectId: "ptube-6bd97",
  storageBucket: "ptube-6bd97.firebasestorage.app",
  messagingSenderId: "282752218641",
  appId: "1:282752218641:web:1230361a932c283518e3b0"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const gallery = document.getElementById("gallery");
const viewer = document.getElementById("viewer");

let allData = {};

db.ref("posts").on("value", snap => {
    allData = snap.val() || {};
    render();
});

function render() {
    const keyword = search.value.toLowerCase();
    gallery.innerHTML = "";

    Object.entries(allData).reverse().forEach(([key, item]) => {
        if (!item.title.toLowerCase().includes(keyword)) return;

        let media = item.type === "video"
            ? `<video src="${item.url}" muted></video>`
            : `<img src="${item.url}">`;

        gallery.innerHTML += `
        <div class="card">
            <div class="thumb ratio-${item.ratio}" onclick="openViewer('${item.type}','${item.url}')">
                ${media}
            </div>
            <h3>${item.title}</h3>
            <button class="delete" onclick="hapus('${key}')">️ Hapus</button>
        </div>`;
    });
}

function upload() {
    if (!title.value || !url.value) return alert("Lengkapi data");

    db.ref("posts").push({
        title: title.value,
        url: url.value,
        type: type.value,
        ratio: ratio.value
    });

    title.value = "";
    url.value = "";
    closePopup();
}

function hapus(key) {
    if (confirm("Hapus konten ini?")) {
        db.ref("posts/" + key).remove();
    }
}

function openPopup() { popup.style.display = "flex"; }
function closePopup() { popup.style.display = "none"; }

function openViewer(type, src) {
    viewer.innerHTML = type === "video"
        ? `<video src="${src}" controls autoplay></video>`
        : `<img src="${src}">`;
    viewer.style.display = "flex";
}

function closeViewer() {
    viewer.style.display = "none";
    viewer.innerHTML = "";
}
</script>

</body>
</html>